Jul 17, 2018 â€¢ [liew211](https://www.github.com/Liew211)  

## Setting up Pihole on boot drive for Raspberry Pi - Part 1

As a member of OLE's Raspberry Pi team, I have recently been tasked with running Pihole concurrently with Planet.  Unfortunately, the two programs occupy the same ports, so I have been working on this one step at a time.  

The first step is to set up Pihole and run it on its own, while Planet is disabled.  The easiest way to disable Planet is to remove the Planet set up in the `autorunonce` file, in the boot drive, essentially creating a *"clean slate"*.  

To do this, you first want to download the latest treehouses image from http://download.treehouses.io, then use [balenaEtcher](https://etcher.io) to flash the image onto your SD card.  Be sure to change balenaEtcher's settings to prevent it from automatically unmounting the SD card once it's done flashing.

In your file explorer, navigate to the `boot` drive, and open the `autorunonce` file in a text editor of your choice.  Delete everthing after line 11, then delete line 9.  The file should now look like this:

```
#!/bin/bash

treehouses rename treehouses
treehouses expandfs
treehouses button bluetooth

#treehouses wifi <wifiname> [password]
#treehouses ap internet <hotspotname> [password]
#treehouses ap local <hotspotname> [password]
#treehouses bridge <wifiname> <hotspotname> [wifipassword] [hotspotpassword]
```
If you have access to your router and an Ethernet cable, you can connect your Raspberry Pi directly; if not, you can also use Wifi.  Add this line to the end of `autorunonce`, replace `<wifiname>` and `[wifipassword]` with your Wifi name and password:

```
treehouses bridge <wifiname> treehouses [wifipassword]
```
Finally, add a reboot command at the end of the file:
```
reboot
```
Now, save the file, and eject the SD card.  Plug the microSD into your Raspberry Pi, plug in your Ethernet cable if you are using it, and power it on.

Once the green light on your Raspberry Pi stabilizes, find its local IP address by typing `ping treehouses.local` in your terminal or command prompt.  You should see something like this:
```
PING treehouses.local (10.0.0.31): 56 data bytes
64 bytes from 10.0.0.31: icmp_seq=0 ttl=64 time=69.424 ms
64 bytes from 10.0.0.31: icmp_seq=1 ttl=64 time=4.640 ms
64 bytes from 10.0.0.31: icmp_seq=2 ttl=64 time=2.945 ms
64 bytes from 10.0.0.31: icmp_seq=3 ttl=64 time=3.372 ms
```
As you can see here its local IP address is `10.0.0.31`.  Type `ssh root@[local IP address]` to enter the root of your Pi.  You will need to create a `pihole` folder for your Pihole project; to do this, run the following commands:
```
cd /srv
mkdir pihole
cd pihole
```
In here, you will create the `docker-compose` file for pihole.  Run `vim pihole.yml`, press `Esc`, and run `:set paste`.  Copy and paste the following:

```yaml
version: "3"

# https://github.com/pi-hole/docker-pi-hole/blob/master/README.md

services:
  pihole:
    container_name: pihole
    image: pihole/pihole:4.3.1-4_armhf
    # For DHCP it is recommended to remove these ports and instead add: network_mode: "host"
    ports:
      - "53:53/tcp"
      - "53:53/udp"
      - "67:67/udp"
      - "80:80/tcp"
      - "443:443/tcp"
    environment:
      TZ: 'America/Chicago'
      # WEBPASSWORD: 'set a secure password here or it will be random'
    # Volumes store your data between container upgrades
    volumes:
       - './etc-pihole/:/etc/pihole/'
       - './etc-dnsmasq.d/:/etc/dnsmasq.d/'
    # run `touch ./var-log/pihole.log` first unless you like errors
    # - './var-log/pihole.log:/var/log/pihole.log'
    dns:
      - 127.0.0.1
      - 1.1.1.1
    # Recommended but not required (DHCP needs NET_ADMIN)
    #   https://github.com/pi-hole/docker-pi-hole#note-on-capabilities
    cap_add:
      - NET_ADMIN
    restart: unless-stopped
```
Press `Esc`, and run `:wq` to save and exit.  Due to a port 53 conflict, you will have to run `service dnsmasq stop` to terminate the existing process on that port.  Finally, start up the Pihole container with 
```
docker-compose -f /srv/pihole/pihole.yml -p pihole up
```
On a web browser, go to `[local IP address]/admin`.  You should see something like this:
![]()

Congrats!  You have successfully set up your Pihole!

